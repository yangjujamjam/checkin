<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>객실 체크인/아웃</title>
<style>
  body {font-family: Arial;text-align:center;margin-top:50px;}
  button {padding:10px 20px;margin:10px;font-size:18px;}
</style>
</head>
<body>

<div id="message">객실 상태 확인 중...</div>
<button id="yesBtn" style="display:none;">네</button>
<button id="noBtn" style="display:none;">아니요</button>

<script>
const params = new URLSearchParams(location.search);
const room = params.get('room'); // URL에서 객실번호 가져오기
const apiUrl = '구글 웹앱 주소';

// 상태 조회
fetch(`${apiUrl}?action=getStatus&room=${room}`)
.then(res => res.json())
.then(data => {
  const currentStatus = data.status === "TRUE";
  document.getElementById('message').innerHTML = currentStatus ?
    `${room} 체크아웃 하시겠습니까?` :
    `${room} 체크인 하시겠습니까?`;

  document.getElementById('yesBtn').style.display = 'inline';
  document.getElementById('noBtn').style.display = 'inline';

  document.getElementById('yesBtn').onclick = () => {
    fetch(`${apiUrl}?action=setStatus&room=${room}&status=${!currentStatus}`)
    .then(res => res.json())
    .then(() => {
      document.getElementById('message').innerHTML = currentStatus ? 
        "이용해주셔서 감사합니다." : `${room} 체크인 완료`;
      document.getElementById('yesBtn').style.display = 'none';
      document.getElementById('noBtn').style.display = 'none';
      setTimeout(()=>{ window.close(); }, 10000);
    });
  };

  document.getElementById('noBtn').onclick = () => {
    window.close();
  };
});
</script>

</body>
</html>
