<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>객실 체크인/아웃</title>
<style>
  body {font-family: Arial;text-align:center;margin-top:50px;}
  button {padding:10px 20px;margin:10px;font-size:18px;}
</style>
</head>
<body>

<div id="message">객실 상태 확인 중...</div>
<button id="yesBtn" style="display:none;">네</button>
<button id="noBtn" style="display:none;">아니요</button>

<script>
const params = new URLSearchParams(location.search);
const room = params.get('room'); 
const apiUrl = 'https://script.google.com/macros/s/AKfycbyrDEZV5uDk8slrVQ_H2fLlcwFCzlWjsY-4DJpBLzl6p8jMFaN1EQrB4rSbmlaC3ysb/exec';

// JSONP 함수
function jsonp(url, callbackName) {
  const script = document.createElement('script');
  script.src = url + '&callback=' + callbackName;
  document.head.appendChild(script);
}

// 최초 상태 조회 콜백 함수
function handleGetStatus(data) {
  const currentStatus = data.status === true || data.status === "TRUE";
  document.getElementById('message').innerHTML = currentStatus ?
    `${room} 체크아웃 하시겠습니까?` :
    `${room} 체크인 하시겠습니까?`;

  document.getElementById('yesBtn').style.display = 'inline';
  document.getElementById('noBtn').style.display = 'inline';

  document.getElementById('yesBtn').onclick = () => {
    jsonp(`${apiUrl}?action=setStatus&room=${room}&status=${!currentStatus}`, 'handleSetStatus');
    document.getElementById('message').innerHTML = currentStatus ? 
      "이용해주셔서 감사합니다." : `${room} 체크인 완료`;
    document.getElementById('yesBtn').style.display = 'none';
    document.getElementById('noBtn').style.display = 'none';
    setTimeout(()=>{ window.close(); }, 10000);
  };

  document.getElementById('noBtn').onclick = () => {
    window.close();
  };
}

// 상태 변경(체크인, 체크아웃) 콜백 함수
function handleSetStatus(data) {
  console.log('상태 변경 완료:', data);
}

// 최초 상태 조회 실행
jsonp(`${apiUrl}?action=getStatus&room=${room}`, 'handleGetStatus');

</script>

</body>
</html>
