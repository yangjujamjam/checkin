<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ê°ì‹¤ ê´€ë¦¬</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body {
  font-family: Arial, sans-serif;
  margin: 0;
  padding: 20px;
  background-color: #f4f6f9;
  text-align: center;
}
h2 {
  margin-top: 30px;
  margin-bottom: 15px;
  font-size: 1.5rem;
  color: #333;
}
.container {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
}
.room {
  width: 120px;
  height: 80px;
  margin: 8px;
  line-height: 80px;
  font-size: 0.9rem;
  font-weight: bold;
  color: #fff;
  border-radius: 8px;
  cursor: pointer;
  transition: transform 0.2s ease;
}
.room:hover {
  transform: scale(1.05);
}
.red { background-color: #f44336; }
.green { background-color: #4caf50; }

@media(max-width:600px){
  .room {
    width: 45%;
    height: 60px;
    line-height: 60px;
    font-size: 0.8rem;
  }
}
</style>
</head>
<body>

<h2>ğŸš ì¹´ë¼ë°˜ (1~12)</h2>
<div id="caravanContainer" class="container"></div>

<h2>ğŸ¡ ë³µì¸µ ìš°ë“œìºë¹ˆ (1~6)</h2>
<div id="woodContainer" class="container"></div>

<script>
const apiUrl = 'https://script.google.com/macros/s/AKfycbyrDEZV5uDk8slrVQ_H2fLlcwFCzlWjsY-4DJpBLzl6p8jMFaN1EQrB4rSbmlaC3ysb/exec';

// ê°ì‹¤ ë°°ì—´ì„ ì •í™•íˆ ìˆœì„œëŒ€ë¡œ ì •ì˜
const caravanRooms = ["ì¹´ë¼ë°˜1","ì¹´ë¼ë°˜2","ì¹´ë¼ë°˜3","ì¹´ë¼ë°˜4","ì¹´ë¼ë°˜5","ì¹´ë¼ë°˜6","ì¹´ë¼ë°˜7","ì¹´ë¼ë°˜8","ì¹´ë¼ë°˜9","ì¹´ë¼ë°˜10","ì¹´ë¼ë°˜11","ì¹´ë¼ë°˜12"];
const woodRooms = ["ìš°ë“œìºë¹ˆ1","ìš°ë“œìºë¹ˆ2","ìš°ë“œìºë¹ˆ3","ìš°ë“œìºë¹ˆ4","ìš°ë“œìºë¹ˆ5","ìš°ë“œìºë¹ˆ6"];

function jsonp(url, callback){
  const script = document.createElement('script');
  script.src = `${url}&callback=${callback}`;
  document.head.appendChild(script);
}

function createRoomDiv(data){
  const div = document.createElement('div');
  div.className = 'room ' + (data.status === true || data.status === "TRUE" ? 'red':'green');
  div.innerText = data.room;
  div.onclick = ()=>{
    if(confirm(div.classList.contains('red') ? "í‡´ì‹¤ì²˜ë¦¬í• ê¹Œìš”?" : "ì…ì‹¤ì²˜ë¦¬í• ê¹Œìš”?")){
      jsonp(`${apiUrl}?action=setStatus&room=${data.room}&status=${!data.status}`, 'handleSetStatus');
    }
  };
  return div;
}

let caravanStatuses = {};
let woodStatuses = {};
let loadedCount = 0;

function handleCaravanStatus(data){
  caravanStatuses[data.room] = data;
  checkLoaded();
}

function handleWoodStatus(data){
  woodStatuses[data.room] = data;
  checkLoaded();
}

function handleSetStatus(data){
  alert('ìƒíƒœ ë³€ê²½ ì™„ë£Œ!');
  location.reload();
}

function checkLoaded(){
  loadedCount++;
  if(loadedCount === (caravanRooms.length + woodRooms.length)){
    renderRooms();
  }
}

function renderRooms(){
  caravanRooms.forEach(room => {
    const data = caravanStatuses[room];
    const div = createRoomDiv(data);
    document.getElementById('caravanContainer').appendChild(div);
  });
  woodRooms.forEach(room => {
    const data = woodStatuses[room];
    const div = createRoomDiv(data);
    document.getElementById('woodContainer').appendChild(div);
  });
}

// ê°ì‹¤ ìƒíƒœ ê°€ì ¸ì˜¤ê¸°
caravanRooms.forEach(room=>{
  jsonp(`${apiUrl}?action=getStatus&room=${room}`,'handleCaravanStatus');
});
woodRooms.forEach(room=>{
  jsonp(`${apiUrl}?action=getStatus&room=${room}`,'handleWoodStatus');
});
</script>

</body>
</html>
